<!--pages/matches/matches.wxml - æˆ‘çš„å¯¹æˆ˜-->
<view class="page">
  <view class="search-bar-wrap">
    <view class="search-input-wrap">
      <text class="search-icon">ğŸ”</text>
      <input
        class="search-input"
        placeholder="æœç´¢æ¯”èµ›åç§°/åœ°ç‚¹"
        placeholder-class="search-placeholder"
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchInput"
      />
    </view>
    <view class="filter-btn {{filterCount > 0 ? 'active' : ''}}" bindtap="onFilterTap">
      <text class="filter-icon">ç­›é€‰</text>
      <view class="filter-badge" wx:if="{{filterCount > 0}}">{{filterCount}}</view>
    </view>
  </view>
  <view class="tabs-wrap">
    <view class="tabs-inner">
      <view
        class="tab-item {{activeTab === 0 ? 'active' : ''}}"
        data-index="0"
        bindtap="onTabChange"
      >æˆ‘å‚ä¸çš„</view>
      <view
        class="tab-item {{activeTab === 1 ? 'active' : ''}}"
        data-index="1"
        bindtap="onTabChange"
      >æˆ‘åˆ›å»ºçš„</view>
    </view>
  </view>

  <scroll-view
    scroll-y
    class="list-area"
    enable-back-to-top
    refresher-enabled
    bindrefresherrefresh="onPullDownRefresh"
  >
    <view wx:if="{{activeTab === 0}}" class="list-inner">
      <view
        class="match-card"
        wx:for="{{displayJoinedList}}"
        wx:key="_id"
        data-id="{{item._id}}"
        bindtap="onMatchTap"
      >
        <view class="card-date">
          <text class="date-month">{{item.dateMonth}}</text>
          <text class="date-day">{{item.dateDay}}</text>
        </view>
        <view class="card-content">
          <view class="card-top">
            <text class="match-name">{{item.name}}</text>
            <text class="status-tag status-{{item.status}}">{{item.statusText}}</text>
          </view>
          <view class="card-info">
            <text class="info-item">ğŸ• {{item.timeText}}</text>
            <text class="info-item">ğŸ“ {{item.locationText}}</text>
          </view>
          <text class="mode-tag">{{item.typeText}} - {{item.subModeText}}</text>
          <view class="result-link" wx:if="{{item.status === 'finished'}}" bindtap="onMatchTap" data-id="{{item._id}}">
            æŸ¥çœ‹å¯¹æˆ˜ç»“æœ >
          </view>
        </view>
      </view>
      <view class="empty-tip" wx:if="{{displayJoinedList.length === 0}}">æš‚æ— å‚ä¸çš„æ¯”èµ›</view>
    </view>

    <view wx:if="{{activeTab === 1}}" class="list-inner">
      <view
        class="swipe-cell"
        wx:for="{{displayCreatedList}}"
        wx:key="_id"
      >
        <view
          class="swipe-delete"
          data-id="{{item._id}}"
          catchtap="onDeleteMatch"
        >åˆ é™¤</view>
        <view
          class="swipe-card-wrap"
          style="transform: translateX({{swipeOffsetMap[item._id] || 0}}rpx)"
          data-id="{{item._id}}"
          bindtouchstart="onSwipeStart"
          bindtouchmove="onSwipeMove"
          bindtouchend="onSwipeEnd"
          bindtap="onSwipeCellTap"
        >
          <view class="match-card">
            <view class="card-date">
              <text class="date-month">{{item.dateMonth}}</text>
              <text class="date-day">{{item.dateDay}}</text>
            </view>
            <view class="card-content">
              <view class="card-top">
                <text class="match-name">{{item.name}}</text>
                <text class="status-tag status-{{item.status}}">{{item.statusText}}</text>
              </view>
              <view class="card-info">
                <text class="info-item">ğŸ• {{item.timeText}}</text>
                <text class="info-item">ğŸ“ {{item.locationText}}</text>
              </view>
              <text class="mode-tag">{{item.typeText}} - {{item.subModeText}}</text>
              <view class="result-link" wx:if="{{item.status === 'finished'}}" catchtap="onMatchTap" data-id="{{item._id}}">
                æŸ¥çœ‹å¯¹æˆ˜ç»“æœ >
              </view>
            </view>
          </view>
        </view>
      </view>
      <view class="empty-tip" wx:if="{{displayCreatedList.length === 0}}">æš‚æ— åˆ›å»ºçš„æ¯”èµ›</view>
    </view>
  </scroll-view>

  <view class="filter-mask {{filterPopupVisible ? 'show' : ''}}" catchtap="onFilterClose"></view>
  <view class="filter-panel {{filterPopupVisible ? 'show' : ''}}">
    <view class="filter-panel-header">
      <text class="filter-panel-title">ç­›é€‰æ¡ä»¶</text>
      <view class="filter-panel-actions">
        <text class="filter-reset" bindtap="onFilterReset">é‡ç½®</text>
        <text class="filter-confirm" bindtap="onFilterConfirm">ç¡®å®š</text>
      </view>
    </view>
    <view class="filter-section">
      <text class="filter-section-title">çŠ¶æ€</text>
      <view class="filter-tags">
        <view
          wx:for="{{statusOpts}}"
          wx:key="value"
          class="filter-tag {{item.selected ? 'selected' : ''}}"
          data-category="status"
          data-value="{{item.value}}"
          bindtap="onFilterToggle"
        >{{item.label}}</view>
      </view>
    </view>
    <view class="filter-section">
      <text class="filter-section-title">èµ›åˆ¶</text>
      <view class="filter-tags">
        <view
          wx:for="{{typeOpts}}"
          wx:key="value"
          class="filter-tag {{item.selected ? 'selected' : ''}}"
          data-category="type"
          data-value="{{item.value}}"
          bindtap="onFilterToggle"
        >{{item.label}}</view>
      </view>
    </view>
    <view class="filter-section">
      <text class="filter-section-title">æ¨¡å¼</text>
      <view class="filter-tags">
        <view
          wx:for="{{subModeOpts}}"
          wx:key="value"
          class="filter-tag {{item.selected ? 'selected' : ''}}"
          data-category="subMode"
          data-value="{{item.value}}"
          bindtap="onFilterToggle"
        >{{item.label}}</view>
      </view>
    </view>
  </view>
</view>
